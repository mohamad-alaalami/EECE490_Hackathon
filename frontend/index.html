<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stories Coffee Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <div class="app-shell">
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-mark">SC</div>
        <div>
          <p class="brand-kicker">Hackathon</p>
          <h1>Stories Coffee</h1>
        </div>
      </div>

      <nav class="nav-tabs" aria-label="Main navigation">
        <button class="nav-tab active" data-page="overview">Overview</button>
        <button class="nav-tab" data-page="clusters">Clusters</button>
        <button class="nav-tab" data-page="branch-detail">Branch Detail</button>
        <button class="nav-tab" data-page="bundles">Bundle Recommender</button>
      </nav>

      <div class="sidebar-foot">
        <p>ML Branch Insights</p>
        <p><a href="/analytics">Analytics Page</a></p>
      </div>
    </aside>

    <main class="content">
      <header class="topbar">
        <div>
          <p class="eyebrow">Dashboard</p>
          <h2 id="page-title">Overview</h2>
        </div>
        <div class="status-chip" id="data-source-chip">Loading data...</div>
      </header>

      <section id="state-loading" class="state-card hidden">
        <p>Loading dashboard data...</p>
      </section>

      <section id="state-error" class="state-card hidden error">
        <p id="error-text">Could not load data.</p>
      </section>

      <section id="page-overview" class="page active">
        <div class="kpi-grid">
          <article class="card kpi">
            <p>Total Branches</p>
            <h3 id="kpi-total-branches">0</h3>
          </article>
          <article class="card kpi">
            <p>Total Revenue</p>
            <h3 id="kpi-total-revenue">$0</h3>
          </article>
          <article class="card kpi">
            <p>Average Health Score</p>
            <h3 id="kpi-avg-health">-</h3>
          </article>
        </div>

        <article class="card table-card">
          <div class="table-head">
            <h3>Branch Performance</h3>
            <input id="branch-search" type="search" placeholder="Search branch name...">
          </div>
          <div class="table-wrap">
            <table id="branches-table">
              <thead>
                <tr>
                  <th data-sort="branch">Branch</th>
                  <th data-sort="cluster">Cluster</th>
                  <th data-sort="health_score">Health Score</th>
                  <th data-sort="total_revenue">Total Revenue</th>
                  <th data-sort="avg_revenue">Avg Revenue</th>
                  <th data-sort="growth">Growth</th>
                  <th data-sort="volatility">Volatility</th>
                  <th data-sort="may_june_drop">May-Jun Drop</th>
                </tr>
              </thead>
              <tbody id="branches-tbody"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="page-clusters" class="page">
        <article class="card cluster-map-card">
          <div class="cluster-map-head">
            <h3>Branch Clusters on PCA Map</h3>
          </div>
          <img
            src="/static/plots/cluster_pca_map.png"
            alt="Cluster PCA map"
            style="width:100%; border-radius:12px; border:1px solid #dfeae4;"
          >
        </article>
        <div id="clusters-grid" class="clusters-grid"></div>
      </section>

      <section id="page-bundles" class="page">
        <article class="card detail-header">
          <div>
            <h3>Bundle Recommender</h3>
            <p class="badge">Test Bundle Feature</p>
          </div>
        </article>

        <article class="card table-card">
          <div class="table-head">
            <h3>Branches with Bundles</h3>
            <p style="font-size: 0.85rem; color: #666; margin-top: 4px;">Click a branch to view its bundle recommendations</p>
          </div>
          <div class="table-wrap">
            <table id="bundles-branches-table">
              <thead>
                <tr>
                  <th data-sort="branch">Branch</th>
                  <th data-sort="cluster">Cluster</th>
                  <th data-sort="health_score">Health Score</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="bundles-branches-tbody"></tbody>
            </table>
          </div>
        </article>

        <article class="card table-card" id="bundles-detail-card" style="display: none;">
          <div class="table-head">
            <h3>Bundle Recommendations for <span id="bundles-branch-name">-</span></h3>
            <button id="bundles-back-btn" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">‚Üê Back to List</button>
          </div>
          <div id="bundles-loading" class="hidden">
            <p>Loading bundle suggestions...</p>
          </div>
          <div id="bundles-empty" class="hidden">
            <p><small>No bundle suggestions for this branch yet.</small></p>
            <p><small>Run: <code>python scripts/run_bundles.py</code></small></p>
          </div>
          <div id="bundles-error" class="hidden">
            <p id="bundles-error-text" style="color: #d9534f;"></p>
          </div>
          <div class="table-wrap" id="bundles-wrap" style="display: none;">
            <table>
              <thead>
                <tr>
                  <th>Bundle Items</th>
                  <th>Discount</th>
                  <th>Bundle Price</th>
                  <th>Expected Profit</th>
                  <th>Reason</th>
                  <th>Lift</th>
                  <th>Support</th>
                </tr>
              </thead>
              <tbody id="bundles-tbody"></tbody>
            </table>
          </div>
        </article>
      </section>

      <section id="page-branch-detail" class="page">
        <article class="card detail-header">
          <div>
            <h3 id="detail-branch-name">Select a branch</h3>
            <p class="badge" id="detail-cluster-badge">Cluster -</p>
          </div>
        </article>

        <div class="mini-grid">
          <article class="card mini">
            <p>Health Score</p>
            <h4 id="detail-health">-</h4>
          </article>
          <article class="card mini">
            <p>Avg Revenue</p>
            <h4 id="detail-avg-revenue">-</h4>
          </article>
          <article class="card mini">
            <p>Growth</p>
            <h4 id="detail-growth">-</h4>
          </article>
          <article class="card mini">
            <p>Volatility</p>
            <h4 id="detail-volatility">-</h4>
          </article>
          <article class="card mini">
            <p>May-Jun Drop</p>
            <h4 id="detail-may-june-drop">-</h4>
          </article>
        </div>

        <article class="card chart-card">
          <div class="chart-title-wrap">
            <h3>Monthly Revenue Trend</h3>
          </div>
          <canvas id="revenue-canvas" width="980" height="320" aria-label="Revenue line chart"></canvas>
        </article>

        <article class="card table-card">
          <h3>Monthly Revenue & Profit</h3>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>Month</th>
                  <th>Revenue</th>
                </tr>
              </thead>
              <tbody id="monthly-tbody"></tbody>
            </table>
          </div>
        </article>

        <article class="card table-card">
          <h3>Bundle Recommendations</h3>
          <div id="bundles-loading" class="hidden">
            <p>Loading bundle suggestions...</p>
          </div>
          <div id="bundles-empty" class="hidden">
            <p><small>No bundle suggestions for this branch yet.</small></p>
            <p><small>Run: <code>python scripts/run_bundles.py</code></small></p>
          </div>
          <div id="bundles-error" class="hidden">
            <p id="bundles-error-text" style="color: #d9534f;"></p>
          </div>
          <div class="table-wrap" id="bundles-wrap" style="display: none;">
            <table>
              <thead>
                <tr>
                  <th>Bundle Items</th>
                  <th>Discount</th>
                  <th>Bundle Price</th>
                  <th>Expected Profit</th>
                  <th>Reason</th>
                  <th>Lift</th>
                  <th>Support</th>
                </tr>
              </thead>
              <tbody id="bundles-tbody"></tbody>
            </table>
          </div>
        </article>
      </section>
    </main>
  </div>

  <script src="/app.js" defer></script>
</body>
</html>
